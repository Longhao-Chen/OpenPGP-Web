<!DOCTYPE html>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='black'>
<meta name='format-detection' content='telephone=no'>
<html>
<head>
<meta charset="utf-8">
<title>使用密码加密文本</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" type="text/css" />
<script src="https://cdn.staticfile.org/openpgp/4.6.2/openpgp.min.js"></script>
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.bundle.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="js/config.js"></script>
<script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
</head>
<body class="container-fluid center">
<script>
//加密部分
async function encrypt(){
	const password = [document.getElementById('passwd').value];
	//密码确认
	if(window.confirm("确认密码：\n"+password[0])){
		try{
			const { data: encrypted } = await openpgp.encrypt({
				message: openpgp.message.fromText(document.getElementById("text").value),	// input as Message object
				passwords: password,
				compression: openpgp.enums.compression.zip	//启用压缩
			});
			document.getElementById("output").value=encrypted;
		}catch(e){
			window.alert("加密错误\n错误代码:"+e);
			throw new Error(e);
		}
	}else{
		alert("加密已取消");
		throw new Error("加密已取消");
	}
	await openpgp.destroyWorker();
	$("#output").show("slow");
	$("#copy").show("slow");
}
</script>
<script>
//清空和隐藏文本框
function cleanall(){
	if(window.confirm("确认清空文本框？")){
		document.getElementById("text").value='';
		document.getElementById("output").value=''
		$("#output").hide();
		$("#copy").hide();
	}
}
</script>
<script>
//元素显示和隐藏部分
$(function(){
	$("#output").hide();
	$("#copy").hide();
})
</script>
<script>
//复制部分的代码
$(function(){
		var clipboard = new ClipboardJS('#copy');
		clipboard.on('success', function(e) {
			e.clearSelection();
			document.getElementById("copy").innerHTML="已复制";
			setTimeout(function(){document.getElementById("copy").innerHTML="复制输出";},2000);
		});
		clipboard.on('error', function(e) {
			alert('复制失败，您的浏览器不支持！');
		});
});
</script>
<h1>使用密码加密文本</h1>
<form>
	<input type="password" class="input-inherit" id="passwd" placeholder="要使用的密码"><br>
</form>
<textarea id="text" rows="20" class="textarea-inherit" placeholder="请输入要加密的信息"></textarea><br>
<div class="row mx-auto" style="width: 95%;">
	<button type="button" onclick="encrypt()" class="col btn btn-primary">加密</button>
	<button data-clipboard-target="#output" id="copy" class="col btn btn-primary">复制输出</button>
	<button type="button" class="btn btn-danger" onclick="cleanall()">清空文本框</button><br>
	<a type="button" class="btn btn-light col-sm-3" href="decrypt.html">跳转到解密</a><br>
</div>
<textarea id="output" rows="10" class="textarea-inherit" readonly></textarea>
</body>
</html>